docker-mailserver
=================

Docker Mailserver based on the famous [ISPMail guide](https://workaround.org/ispmail/).
All images are based on [Alpine Linux](https://alpinelinux.org) and are so small as possible.

[![Build Status](https://travis-ci.org/jeboehm/docker-mailserver.svg?branch=master)](https://travis-ci.org/jeboehm/docker-mailserver)

Services
--------
| Service                | Address                      |
| ---------------------- | ---------------------------- |
| POP3 (starttls needed) | 127.0.0.1:110                |
| POP3S                  | 127.0.0.1:995                |
| IMAP (starttls needed) | 127.0.0.1:143                |
| IMAPS                  | 127.0.0.1:993                |
| SMTP (starttls needed) | 127.0.0.1:25                 |
| Management Interface   | http://127.0.0.1:81/manager/ |
| Webmail                | http://127.0.0.1:81/webmail/ |

Accounts
--------
| Username          | Password |
| ----------------- | -------- |
| admin@example.com | changeme |

You can create or edit accounts via the management interface (see above).
Passwords can also be edited via webmail.

Filters
------------
By default, spam is filtered by [rspamd](https://rspamd.com/).

| Method                                                               | Variable            |
| -------------------------------------------------------------------- | ------------------- |
| rspamd                                                               | -                   |
| ClamAV virus & malware filtering                                     | FILTER_VIRUS        |
| Block attachments by type (bat, com, exe, dll, vbs, docm, doc, dzip) | FILTER_MIME         |

Installation
------------
- Clone this repository at first. The command `bin/production.sh` is a wrapper for [docker-compose](https://docs.docker.com/compose/).
  It loads the needed configuration files for using the mailserver in production mode.
- Copy the file `.env.dist` to `.env` and change the variables in it to fit your needs.
  They're described in this file later.
- Run `bin/production.sh pull` to obtain the images.
- `bin/production.sh up -d` creates and starts the containers.

Volume Management (Where are my files?)
---------------------------------------
Docker manages the data volumes. The first startup creates four volumes, named data-db, -mail, -tls and -filter.
Run `docker volume inspect <name>` to get their real path in the filesystem.

TLS certificates
----------------
The TLS certificate is stored in the data-tls volume. Obtain its path by running `docker volume inspect`
and replace the autogenerated certificate with a real one.

.env file (Configuration)
-------------------------
| Variable            | Description                                                 |
| ------------------- | ----------------------------------------------------------- |
| MAILNAME            | Should match your reverse DNS record                        |
| POSTMASTER          | Mail address of the system's administrator                  |
| FILTER_MIME         | Discard mails with suspicious files attached (see above)    |
| FILTER_VIRUS        | Discard mails with virus or malware files attached          |
| ENABLE_IMAP         | Enable IMAP4 support                                        |
| ENABLE_POP3         | Enable POP3 support                                         |
| ADMIN_USERS         | Mail addresses of users that are allowed to use the manager |
| CONTROLLER_PASSWORD | Password for accessing the rspamd web interface             |

Override container configuration
--------------------------------
Container configurations can be overridden by creating the file `docker-compose.override.yml` in the root folder.
The startup script will load it automatically.

If you need further assistance, check the [docker-compose](https://docs.docker.com/compose/) manual.
